@using X.PagedList.Mvc.Core
@using X.PagedList
@model X.PagedList.IPagedList<EProject.NETCore.Models.Competition>
@{
    bool isAdmin = ViewData["isAdmin"] != null && (bool)ViewData["isAdmin"];
}
@section Styles {
    <link rel="stylesheet" href="~/css/contest.css" />
    <link rel="stylesheet" href="~/css/paging.css" />
}
@{
    var notification = TempData["Notification"] as string;
}

@if (!string.IsNullOrEmpty(notification))
{
    @Html.Partial("notification", notification)
}
<section class="contest">
    <div class="contest_main">
        <div class="contest_name">
            <h1>Competition</h1>
        </div>
        <div class="contest_tool" style="display: @(isAdmin ? "block" : "none")">
            <!-- Admin add -->
            <div class="tool_add">
                <a href="/Contest/NewContest">Add Competition</a>
            </div>
        </div>
        <div class="contest_list">
            @if (Model != null && Model.Any())
            {
                @foreach (var contest in Model)
                {
                    <!-- Item -->
                    <div class="list_ct">
                        <div class="ct_left">
                            <div class="left_name">
                                <p>@contest.Title</p>
                            </div>
                            <div class="left_time">
                                <p>Time: <span class="contest-time">@contest.StartDate.ToString("dd/MM/yyyy") - @contest.EndDate.ToString("dd/MM/yyyy")</span></p>
                            </div>
                        </div>
                        <div class="ct_right">
                            <!-- Auto -->
                            <div class="right_btt">
                                <!-- Still Valid -->
                                <div class="btt_still">
                                    <span class="time_remaining" id="time_remaining"></span>
                                    <a href="/Contest/DetailContest/@contest.Id" class="btt_view right_btn">Details</a>
                                    <a href="/Submission/UploadSubmission/@contest.Id" class="btt_join right_btn">Join now</a>
                                </div>
                                <!-- Expired -->
                                <div class="btt_expired" style="display: none;">
                                    <a href="/Contest/DetailContest/@contest.Id" class="btt_view right_btn">Details</a>
                                    <button class="btt_none">Expired</button>
                                </div>
                                <!-- Admin -->
                                <div class="btt_admin" style="display: @(isAdmin ? "block" : "none")">
                                    <button class="btt_delete" onclick="confirmDelete(@contest.Id)">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <p>No competitions found.</p>
            }
            <!-- End List Item -->
        </div>
        @Html.PagedListPager(Model, page => Url.Action("Contest", new { page, pageSize = 5 }),
                 new PagedListRenderOptions
        {
            UlElementClasses = new[] { "pagination" },
            LiElementClasses = new[] { "page-item" },
            PageClasses = new[] { "page-link" },
        })
    </div>
</section>

@section Scripts {
    <script src="~/js/contest.js"></script>
    <script>
        function confirmDelete(contestId) {
            if (confirm('Are you sure you want to delete this contest? This action will also delete all related submissions.')) {
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = '/Contest/deleteContest/' + contestId;
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
}
